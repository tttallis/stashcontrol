{% load static %}
<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>StashControl</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
	<style>
		
	</style>
   <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  </head>
  <body>
  <section class="section">
	<div class="container">
	 <div class="columns">
		 <div class="column is-two-thirds">
			 <div class="columns is-mobile is-centered is-vcentered">
			   <div class="column is-one-fifth">
				 <img src="{% static 'stash.svg' %}" alt="Stash Manager" />
			   </div>
			   <div class="column">
				 <span class="subtitle">Hi {{ request.user }}</span><br>
			   </div>
			 </div>


	<div class="tabs is-medium is-boxed">
	  <ul class="tabmenu">
		<li class="is-active" id="feed"><a>gm on hand</a></li>
		<li id="grams"><a>gm/day</a></li>
		<li id="cost"><a>$/day</a></li>
		<li id="cannabinoids"><a>cannabinoids</a></li>
	  </ul>
	</div>
	<div id="graph" style="width:100%;height:400px;"></div>
		 </div>
		 <div class="column content">
			 <p>{% now "F" %}</p>
			 <h3>Scripts dispensed in {% now "F" %}</h3>
			 <table>
				 {% for script in dispensed %}{{total}}
					<tr>
						<td><a href="https://catalyst.honahlee.com.au/app/products/{{ script.product.catalyst_id }}">{{ script.product.name }}</a></td>
						<td><small class="has-text-grey">${{ script.cost }}</small></td>
						<td><small class="has-text-grey">{{ script.product.product_weight }}g</small></td>
					</tr>
				{% endfor %}
			 </table>
		 </div>
	</div>
  </section>
<script>
let feedData = null;
let gramsData = null;
let costData = null;
let cannabinoidsData = null;

$.getJSON("/feed/", feedCallBack);
$.getJSON("/grams/", gramsCallBack);
$.getJSON("/cost/", costCallBack);
$.getJSON("/cannabinoids/", cannabinoidsCallBack);

$("#feed a").click(function(){
	$('.tabmenu li').removeClass('is-active');
	$('#feed').addClass('is-active');
	div = document.getElementById('graph');
	Plotly.newPlot( div, feedData);
});

$("#grams a").click(function(){
	$('.tabmenu li').removeClass('is-active');
	$('#grams').addClass('is-active');
	div = document.getElementById('graph');
	Plotly.newPlot( div, gramsData);
});

$("#cost").click(function(){
	$('.tabmenu li').removeClass('is-active');
	$('#cost').addClass('is-active');
	div = document.getElementById('graph');
	Plotly.newPlot( div, costData);
});

$("#cannabinoids").click(function(){
	$('.tabmenu li').removeClass('is-active');
	$('#cannabinoids').addClass('is-active');
	div = document.getElementById('graph');
	Plotly.newPlot( div, cannabinoidsData);
});

function feedCallBack(data)
{
	feedData = data;
	div = document.getElementById('graph');
	Plotly.newPlot( div, feedData);
}

function gramsCallBack(data)
{
	gramsData = data;
}

function costCallBack(data)
{
	costData = data;
}

function cannabinoidsCallBack(data)
{
	cannabinoidsData = data;
}
  </script>
  </body>
</html>